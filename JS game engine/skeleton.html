<!-- A basic 2D HTML + JavaScript game engine, consisting of:
1. Canvas element, 800x600
2. Render loop
3. Update loop
4. Global data for current mouse position, stored as vector class
 -->

<!DOCTYPE html>
<html>
<head>
	<title>Game Engine</title>
	<style type="text/css">
		canvas {
			border: 1px solid black;
		}
	</style>
	<script type="text/javascript" src="Vector2D.js"></script>
	<script type="text/javascript" src="Sprite.js"></script>
</head>
<body>
	<canvas id="gameCanvas" width="800" height="600"></canvas>
	<script type="text/javascript">
		// Get the canvas element
		var canvas = document.getElementById("gameCanvas");
		// Get the 2D context
		var context = canvas.getContext("2d");
		
		// Create a new vector object
		var mousePos = new Vector2D();
		
		const playerSize = 32;
		let playerSprite;
		(async () => {
			playerSprite = await Sprite.buildSprite(
				'player-ship.png',
				new Vector2D((canvas.width-playerSize) / 2, canvas.height-playerSize),
				new Vector2D(playerSize, playerSize),
				context
			);
		})();
		
		var lastCallTime = Date.now();
		
		// Update the mouse position
		function setMousePosition(e) {
			mousePos.x = e.clientX;
			mousePos.y = e.clientY;
		}
		
		// Add event listener for mouse movement
		canvas.addEventListener("mousemove", setMousePosition);
		
		// Render loop
		function render() {
			// Clear the canvas
			context.clearRect(0, 0, canvas.width, canvas.height);
			
			if (playerSprite != undefined) {
				playerSprite.draw();
			}
		}
		
		// Update loop
		function update(deltaTime) {
			if (playerSprite != undefined) {
				playerSprite.position.x = mousePos.x
				playerSprite.position.y = mousePos.y
			}
		}
		
		// Game loop
		function loop() {
			var currentTime = Date.now();
			var deltaTime = currentTime - lastCallTime;
			lastCallTime = currentTime;
			update(deltaTime);
			render();
			// Call the loop function again
			window.requestAnimationFrame(loop);
		}
		
		// Call the loop function for the first time
		loop();
	</script>
</body>
</html>